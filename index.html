<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tax Distribution Calculator</title>

<style>


  /* Styles for the text block that appears on click */
  .text-block {
    display: none; /* Hide the text block initially */
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: white; /* White background */
    color: black; /* Black text color */
    padding: 10px;
    box-sizing: border-box;
    overflow: auto; /* In case the text is too long */
    transition: opacity 0.3s ease; /* Smooth transition for the text block */
  }

  /* Class to toggle visibility */
  .show-text {
    display: flex; /* Show the text block */
    justify-content: center; /* Center the text block content */
    align-items: center; /* Center the text block content */
    text-align: center; /* Center text */
  }


  /* This styles the calculate button */
  #taxForm button[type="submit"] {
    background-color: orange; /* Sets the background color to orange */
    color: black; /* Sets the text color to white for contrast */
    border: none; /* Removes the border */
    cursor: pointer; /* Changes the cursor to a pointer when hovering over the button */
  }

  .results-text {
    font-size: 30px; /* Set the font size to 20 pixels */
    color: white; /* Set the text color to white */
    margin-bottom: 20px; /* Add space below the text */
    /* Add any other desired styles */
  }

  #results, #additionalResults {
    display: flex;
    flex-wrap: wrap;
    gap: 10px; /* Adjusts the gap between tiles */
    justify-content: flex-start; /* Aligns tiles to the start of the container */
    align-items: stretch; /* Stretches the tiles to fill the container height */
  }

  

  .result-tile-ca {
    flex: 1 0 calc(20% - 10px); /* Adjusts to 5 tiles per row with the gap */
    max-width: calc(20% - 10px); /* Adjusts to 5 tiles per row with the gap */
    background-color: #97ebc5; /* Sets the tile background to white */
    position: relative; /* Needed for absolute positioning of children */
    box-sizing: border-box; /* Includes padding and border in the element's total width and height */
    /* Set a minimum height if needed, or remove if you want height to be automatic */
    height: 200px; /* Optional: you can adjust this value as needed */
  }

  .result-tile img {
    width: 100%; /* Set image width to be 50% of its container */
    height: auto; /* Maintain the aspect ratio */
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    object-fit: contain;
  }



  .info-container {
    position: absolute; /* This positions the container over the image */
    bottom: 0; /* Aligns the container to the bottom of the tile */
    left: 0; /* Aligns the container to the left of the tile */
    width: 100%; /* Ensures the container spans the width of the tile */
    background-color: transparent; /* Makes the background transparent */
    color: black; /* Change text color to black */
    padding: 5px; /* Padding inside the container */
    box-sizing: border-box; /* Includes padding in the width and height */
    display: flex; /* Positions amount and name side by side */
    justify-content: space-between; /* Distributes space between amount and name */
    align-items: center; /* Vertically centers the text */
    padding: 10px; /* Adjust the padding as needed */
  }


  .amount, .name {
      margin: 0; /* Remove any default margins */
      /* Add any additional text styling you want here */
  }



  #main-title {
    color: #97ebc5; /* Sets the color to white */
    /* Add any other styling you want for your title here */
  }

  #taxForm {
    margin-bottom: 30px; /* Adjust the value as needed to create more or less space */
  }

  .amount {
    font-size: 30px; /* Larger font size for the amount */
    font-weight: bold; /* Optional: makes the font bold */
  }

  .name {
    font-size: 18px; /* Smaller font size for the name */
  }

  .caption {
    font-size: 20px; /* This sets the font size to 16 pixels */
    /* Add any other styles you want for the caption here */
  }

  body {
    font-family: Helvetica, sans-serif;
    margin: 0;
    background-color: black; /* Sets the background color to black */
    padding: 20px; /* Adds padding around the content */
  }
  
  .container {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    color: white;
    padding: 20px;
    width: 100%;
    margin: 0 auto;
  }


  .form-row {
    display: flex; /* Enables flexbox layout */
    flex-direction: row; /* Stacks children horizontally */
    align-items: flex-end; /* Aligns children to the end (bottom) */
    justify-content: flex-start; /* Aligns form elements to the start (left) */
    flex-wrap: wrap; /* Allows form elements to wrap onto the next line if needed */
    gap: 10px; /* Optional: adds space between items */
    width: 100%; /* Ensure the form row takes up the full width of its container */
  }

  .form-group {
    display: flex;
    flex-direction: column;
    justify-content: flex-end; /* Aligns the button to the bottom */
    height: 100%; /* Ensures the form-group fills the height */
  }

  /* If you want only the button to be aligned to the bottom, use this instead */
  .form-group button {
      margin-top: auto; /* Pushes the button to the bottom */
  }

  /* If you have a separate style for your <h1>, you might want to adjust it */
  h1 {
    align-self: flex-start; /* Aligns the title to the left */
    margin-bottom: 0; /* Removes bottom margin to align with form fields */
  }

  .form-group {
    display: flex;
    flex-direction: column;
  }

  .form-group label {
    margin-bottom: 5px; /* Spacing between label and input/select */
  }

  /* Apply the same styles to both text and number input types, as well as select and button elements */
  .form-group input[type="text"],
  .form-group input[type="number"],
  .form-group select,
  .form-group button {
    height: 40px; /* Sets a fixed height for all input/select/button elements */
    padding: 0 10px; /* Adjust padding as needed, while keeping the height consistent */
    box-sizing: border-box; /* Includes padding and border in the element's total height */
  }

  /* You can adjust the button padding if needed */
  .form-group button {
    padding: 0 20px; /* Button padding can be adjusted independently from height */
  }

  #results div {
    margin-bottom: 5px; /* Spacing below each result */
  }

  
  #results {
      display: flex;
      flex-wrap: wrap;
      gap: 10px; /* Adjust the gap between tiles as needed */
  }

  /* Base styles for .result-tile that apply to all screen sizes */
  .result-tile {
    width: 400px; /* Set the width of the tiles */
    height: 250px; /* Set the height of the tiles */
    border: 0px solid #ddd; /* Add a border to the tiles */
    text-align: center; /* Center the text */
    display: flex;
    color: #97ebc5; /* Text color */
    flex-direction: column;
    justify-content: space-between; /* Distributes space evenly */
    padding: 10px;
    box-sizing: border-box;
    background-color: #d2a36c; /* Sets the tile background color */
    margin: 5px; /* Margin around tiles */
    position: relative; /* Needed for absolute positioning of children */
  }

  /* Media query for small screens */
  @media (max-width: 767px) { /* Adjust this breakpoint as needed */
    #results {
      justify-content: center; /* Center tiles when they stack */
    }
    .result-tile {
      flex-basis: 100%; /* Each tile takes full width on small screens */
      max-width: 100%; /* Ensures the tile does not exceed the screen width */
      margin: 5px 0; /* Adjust margin for vertical stacking */
    }
  }



  .result-tile img {
  width: 60%; /* Set image width to 70% of its container */
  height: 60%; /* Set image height to 70% of its container */
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  object-fit: contain; /* This will ensure that the image is scaled properly */
}


  </style>
  
  
  
  
  
  


</head>
<body>

  <div class="container">
    <form id="taxForm">
      <div class="form-row">
        <h1>Where do my taxes go?</h1>
        <div class="form-group">
          <label for="income">Gross Annual Income:</label>
          <input type="text" id="income" required pattern="\d{1,3}(,\d{3})*(\.\d+)?(?!.*\d)" title="Income should be a number. Example: 12,345">
        </div>            
        <div class="form-group">
          <label for="filingStatus">Filing Status:</label>
          <select id="filingStatus" required>
            <option value="single">Single</option>
            <option value="married">Married Filing Jointly</option>
          </select>
        </div>

        <!-- New form-group for State Selection -->
        <div class="form-group">
          <label for="stateSelection">State:</label>
          <select id="stateSelection" required>
            <option value="CA">CA</option>
          </select>
        </div>



        <div class="form-group">
          <button type="submit">Calculate</button>
        </div>
      </div>

    </form>
    <div id="results-text" style="display: none;"></div>
    <h2 id="federalResultsText" style="display: none;">Federal Taxes</h2>
    <div id="results">
      <!-- Results will be displayed here -->
    </div>

   <!-- New section for additional results -->
    <h2 id="additionalResultsText" style="display: none;">California State Taxes</h2>
    <div id="additionalResults">
      <!-- Additional results will be displayed here -->
    </div>


</div>

      



<script>
  // Define your tax brackets and rates here
  const taxBrackets = {
    single: [
      { limit: 9950, rate: 0.10 },
      { limit: 40525, rate: 0.12 },
      { limit: 86375, rate: 0.22 },
      { limit: 164925, rate: 0.24 },
      { limit: 209425, rate: 0.32 },
      { limit: 523600, rate: 0.35 },
      { limit: Infinity, rate: 0.37 }
    ],
    married: [
      { limit: 19900, rate: 0.10 },
      { limit: 81050, rate: 0.12 },
      { limit: 172750, rate: 0.22 },
      { limit: 329850, rate: 0.24 },
      { limit: 418850, rate: 0.32 },
      { limit: 628300, rate: 0.35 },
      { limit: Infinity, rate: 0.37 }
    ]
  };


  const CAtaxBrackets = {
    single: [
      { limit: 8932, rate: 0.01 },
      { limit: 21175, rate: 0.02 },
      { limit: 33421, rate: 0.04 },
      { limit: 46394, rate: 0.06 },
      { limit: 58634, rate: 0.08 },
      { limit: 299508, rate: 0.093 },
      { limit: 359407, rate: 0.103 },
      { limit: 599012, rate: 0.113 },
      { limit: Infinity, rate: 0.123 }
    ],
    married: [
      { limit: 17864, rate: 0.01 },
      { limit: 42350, rate: 0.02 },
      { limit: 66842, rate: 0.04 },
      { limit: 92788, rate: 0.06 },
      { limit: 117268, rate: 0.08 },
      { limit: 599016, rate: 0.093 },
      { limit: 718814, rate: 0.103 },
      { limit: 1198024, rate: 0.113 },
      { limit: Infinity, rate: 0.123 }
    ]
  };



  // Define your budget data
 

  



  // Function to calculate the total tax based on income and filing status
  function calculateTotalTax(income, filingStatus) {
    let remainingIncome = income;
    let totalTax = 0;
    const brackets = taxBrackets[filingStatus];

    for (const bracket of brackets) {
      if (remainingIncome > bracket.limit) {
        const taxableIncome = bracket.limit - (brackets[brackets.indexOf(bracket) - 1]?.limit || 0);
        totalTax += bracket.rate * taxableIncome;
        remainingIncome -= taxableIncome;
      } else {
        totalTax += bracket.rate * remainingIncome;
        break;
      }
      console.log('Bracket:', bracket.limit, 'Rate:', bracket.rate, 'Total Tax:', totalTax, 'Remaining Income:', remainingIncome);
    }
    console.log('Total Tax Calculated:', totalTax);
    return totalTax;
  }

  // Function to calculate the total state tax based on income and filing status
  function calculateTotalStateTax(income, filingStatus) {
    let remainingIncome = income;
    let totalStateTax = 0;
    const brackets = CAtaxBrackets[filingStatus]; // Use the correct state brackets object

    for (const bracket of brackets) {
      if (remainingIncome > bracket.limit) {
        const taxableIncome = bracket.limit - (brackets[brackets.indexOf(bracket) - 1]?.limit || 0);
        totalStateTax += taxableIncome * bracket.rate;
        remainingIncome -= taxableIncome;
      } else {
        totalStateTax += remainingIncome * bracket.rate;
        break;
      }
    }
    return totalStateTax;
  }




  document.getElementById('income').addEventListener('input', function (e) {
    // Remove any characters that are not numbers or commas
    let value = e.target.value.replace(/[^\d,]/g, '');
    // Remove all commas to avoid conflicts in the next formatting
    value = value.replace(/,/g, '');
    // Convert the cleaned value to a number
    const number = parseInt(value, 10);
    // Format the number with commas and update the input value
    e.target.value = isNaN(number) ? '' : number.toLocaleString();
  });


  async function fetchAndParseCSV(url) {
    const response = await fetch(url);
    const csvText = await response.text();
    const lines = csvText.trim().split('\n');
    const data = lines.slice(1).map(line => { // Skip the header row
      const fields = line.match(/(".*?"|[^",\s]+)(?=\s*,|\s*$)/g);
      if (fields.length === 4) { // Make sure each line has exactly 4 fields
        return {
          name: fields[0].replace(/^"|"$/g, ''),
          percent: parseFloat(fields[1]),
          image: fields[2],
          description: fields[3].replace(/^"|"$/g, '')
        };
      } else {
        console.error('Incorrect number of fields:', line);
        return null; // or handle the error as appropriate
      }
    });
    return data.filter(entry => entry); // Remove any null entries due to errors
  }



  function displayResults(budgetData, totalTax) {
    const federalResultsText = document.getElementById('federalResultsText');
    federalResultsText.innerHTML = 'Federal Taxes';
    federalResultsText.style.display = 'block';
    
    const resultsDiv = document.getElementById('results');
    resultsDiv.innerHTML = ''; // Clear previous results

    console.log('Parsed budget data:', budgetData);
    budgetData.forEach((budgetItem, index) => { // Include 'index' here as the second parameter
      console.log(`Processing item ${index}:`, budgetItem); // Debug log
      console.log(`Percent value for item ${index}:`, budgetItem.percent); // Log the percent value
      const amount = totalTax * (budgetItem.percent / 100);
      console.log(`Calculated amount for item ${index}:`, amount); // Debug log
      const formattedAmount = amount.toLocaleString('en-US', {
        style: 'currency',
        currency: 'USD',
        maximumFractionDigits: 0,
      });

      // Create and append the tile
      const tile = document.createElement('div');
      tile.classList.add('result-tile');

      let image;
      if (budgetItem.image) {
        image = document.createElement('img');
        image.src = budgetItem.image;
        image.alt = budgetItem.name;
        image.style.display = 'block'; // Ensure the image is visible initially
        tile.appendChild(image);
      }

      const infoContainer = document.createElement('div');
      infoContainer.classList.add('info-container');

      const amountDiv = document.createElement('div');
      amountDiv.classList.add('amount');
      amountDiv.textContent = formattedAmount;
      infoContainer.appendChild(amountDiv);

      const nameDiv = document.createElement('div');
      nameDiv.classList.add('name');
      nameDiv.textContent = budgetItem.name;
      infoContainer.appendChild(nameDiv);

      tile.appendChild(infoContainer);

      const textBlock = document.createElement('div');
      textBlock.classList.add('text-block');
      textBlock.style.display = 'none'; // Initially hide the text block

      // Add description to the text block
      const descriptionParagraph = document.createElement('p');
      descriptionParagraph.classList.add('description');
      descriptionParagraph.textContent = budgetItem.description;
      textBlock.appendChild(descriptionParagraph);

      tile.appendChild(textBlock);

      tile.addEventListener('click', function() {
        textBlock.style.display = textBlock.style.display === 'none' ? 'block' : 'none';
        if (image) {
          image.style.display = image.style.display === 'none' ? 'block' : 'none';
        }
      });

      resultsDiv.appendChild(tile);
    });
  }



  function displayAdditionalResults(additionalBudgetData, totalTax) {
    const additionalResultsText = document.getElementById('additionalResultsText');
    additionalResultsText.style.display = 'block';

    const additionalResultsDiv = document.getElementById('additionalResults');
    additionalResultsDiv.innerHTML = ''; // Clear previous additional results

    additionalBudgetData.forEach((budgetItem) => {
      const amount = totalTax * (budgetItem.percent / 100);
      const formattedAmount = amount.toLocaleString('en-US', {
        style: 'currency',
        currency: 'USD',
        maximumFractionDigits: 0,
      });

      // Create and append the tile
      const tile = document.createElement('div');
      tile.classList.add('result-tile');

      let image;
      if (budgetItem.image) {
        image = document.createElement('img');
        image.src = budgetItem.image;
        image.alt = budgetItem.name;
        image.style.display = 'block'; // Make sure the image is visible initially
        tile.appendChild(image);
      }

      const infoContainer = document.createElement('div');
      infoContainer.classList.add('info-container');

      const amountDiv = document.createElement('div');
      amountDiv.classList.add('amount');
      amountDiv.textContent = formattedAmount;
      infoContainer.appendChild(amountDiv);

      const nameDiv = document.createElement('div');
      nameDiv.classList.add('name');
      nameDiv.textContent = budgetItem.name;
      infoContainer.appendChild(nameDiv);

      tile.appendChild(infoContainer);

      const textBlock = document.createElement('div');
      textBlock.classList.add('text-block');
      textBlock.style.display = 'none'; // Initially hide the text block

      // Add description to the text block
      const descriptionParagraph = document.createElement('p');
      descriptionParagraph.classList.add('description');
      descriptionParagraph.textContent = budgetItem.description;
      textBlock.appendChild(descriptionParagraph);

      tile.appendChild(textBlock);

      tile.addEventListener('click', function() {
        textBlock.style.display = textBlock.style.display === 'none' ? 'block' : 'none';
        if (image) {
          image.style.display = image.style.display === 'none' ? 'block' : 'none';
        }
      });

      additionalResultsDiv.appendChild(tile);
    });
  }


  



  // Event listener for the form submission
  document.getElementById('taxForm').addEventListener('submit', function (event) {
    event.preventDefault(); // Prevent the default form submission

    // Get the income and filing status from the form
    // When reading the income for calculations, remove commas
    const income = Number(document.getElementById('income').value.replace(/,/g, ''));

    const filingStatus = document.getElementById('filingStatus').value;
    const state = document.getElementById('stateSelection').value;

    // Calculate the total federal tax
    const totalFederalTax = calculateTotalTax(income, filingStatus);

    // Calculate the total state tax
    const totalStateTax = calculateTotalStateTax(income, filingStatus); // This should use the state tax brackets

    // Call displayResults to update the displayed federal budget amounts
    const csvUrl = 'federalbudget.csv'; // Replace with the actual URL to your CSV file
    fetchAndParseCSV(csvUrl).then(parsedData => {
      // Now call displayResults with the data from the CSV
      displayResults(parsedData, totalFederalTax);
    }).catch(error => {
      console.error('Error loading or parsing the CSV file:', error);
    });

    // Call displayResults to update the displayed state budget amounts
    const csvUrl2 = 'statebudget.csv'; // Replace with the actual URL to your CSV file
    fetchAndParseCSV(csvUrl2).then(parsedData => {
      // Now call displayResults with the data from the CSV
      displayAdditionalResults(parsedData, totalStateTax);
    }).catch(error => {
      console.error('Error loading or parsing the CSV file:', error);
    });

        // New call to display additional results with state tax
        //displayAdditionalResults(additionalBudgetData, totalStateTax);
  });




</script>
</body>
</html>
